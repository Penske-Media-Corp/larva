@import "../mixins/pmc-breakpoint";

@mixin _grid( $columns ) {
	--cols: #{$columns};

	> * {
		flex-basis: ( ( 1 / $columns ) * 100% );
	}

}

@mixin _grid-selector( $columns, $breakpoint: false, $namespace: '' ) {
	@if $breakpoint {
		@include pmc-breakpoint( $breakpoint ) {
			.#{$namespace}a-cols#{$columns}\@#{$breakpoint} {
				@include _grid( $columns );
			}
		}
	} @else {
		.#{$namespace}a-cols#{$columns} {
			@include _grid( $columns );
		}
	}
}

@mixin _grid-column( $columns, $span ) {
	@supports ( display: grid ) {
		grid-column: span #{$span};
	}
}

@mixin _grid-column-fallback( $columns, $span ) {
	flex-basis: ( $span / $columns * 100% );
}

@mixin _grid-span-selector( $columns, $span: 1, $breakpoint: false, $namespace: '' ) {

	@if $breakpoint {
		@include pmc-breakpoint( $breakpoint ) {

			.#{$namespace}a-span#{$span}\@#{$breakpoint} {
				@include _grid-column( $columns, $span );
			}

			// Higher specificity to account for nested grids.
			.#{$namespace}a-cols#{$columns}\@#{$breakpoint} > .#{$namespace}a-span#{$span}\@#{$breakpoint} {
				@include _grid-column-fallback( $columns, $span );
			}

		}
	} @else {
		.#{$namespace}a-span#{$span} {
			@include _grid-column( $columns, $span );
		}

		.#{$namespace}a-cols#{$columns} > .#{$namespace}a-span#{$span} {
			@include _grid-column-fallback( $columns, $span );
		}
	}

}

@mixin _grid-class-generator( $tokens ) {

	@if type-of($tokens) != 'list' {
		@error "`#{$tokens}` is not a valid value for $tokens. It must be a list of maps.";
	}

	@each $grid in $tokens {
		$breakpoint: map-get( $grid, breakpoint );
		$columns: map-get( $grid, columns );
		$spans: map-get( $grid, spans );

		// Outputs pmc-colsX selector to be used in conjunction with .pmc-grid.
		@include _grid-selector( $columns, $breakpoint );

		@if $spans {

			@each $span in $spans {

				// Outputs pmc-spanX selector to be used in conjunction with .pmc-grid-item.
				@include _grid-span-selector(
					$columns,
					$span,
					map-get( $grid, breakpoint )
				);
			}
		}
	}
}